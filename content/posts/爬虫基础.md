---
date: 2025-01-04T09:14:26+08:00
description: ""
image: ""
lastmod: 2025-01-04
showTableOfContents: true
tags: ["Python","爬虫"]
title: "爬虫基础"
type: "post"
---
# 1. URI和URL
URI：全称Uniform Resource Identifier，即统一资源标志符；
URL：Uniform Resource Locator，即统一资源定位符。
URL基本组成格式：
```
scheme://[username:password@]hostname[:port][/path][;parameters][?query][fragment]
```
scheme：协议。常用的协议有http、https、Ftp等，另外schcme也被常称作protocol。
usemame、password：用户名和密码。
hostname：主机地址。可以是域名或IP地址。
port：端口。服务器设定的端口。
path：路径。用来指定访问某个资源时的附加信息。
query：查询。用来查询某些资源。
fragment:片段。对资源描述的部分补充。
# 2.HTTP and HTTPS
HTTP为超文本传输协议，作用是把超文本数据从网络传输到本地测览器，能够保证高效而准确地传输超文本文档。
HTTPS是以安全为目标的HTTP通道，换句话说，就是HTTP的安全版，即在HTTP下加人SSL层
HTTPS工作大概流程：
- 客户端发起请求，服务器返回公钥证书。
- 客户端验证证书的合法性。
- 使用公钥加密生成一个会话密钥。
- 双方使用该会话密钥加密和解密数据。
## 2.1HTTP请求过程
HTTP 请求通常由以下几个部分组成：
### 2.1.1 请求方法
HTTP 提供了多种请求方法，每种方法的语义不同。常见的请求方法有：
- **GET**：请求指定的资源，通常用于获取数据。
- **POST**：向服务器发送数据，通常用于提交表单或上传文件。
- **PUT**：上传指定资源的完整替换版本。
- **DELETE**：删除指定资源。
- **PATCH**：部分更新资源。
- **HEAD**：请求服务器返回响应头部，通常用于检查资源是否存在。
- **OPTIONS**：询问服务器支持哪些 HTTP 方法。
### 2.1.2 请求网址（Request URL）
请求的 URL 指定了要访问的资源的位置，包含了协议、主机、路径、查询参数等信息。
### 2.1.3 请求头（Request Headers）
请求头部提供了关于客户端、请求和数据的额外信息。常见的请求头包括：
- **Host**：指定目标主机的域名。
- **User-Agent**：客户端软件的标识。
- **Accept**：告知服务器客户端能够处理的数据类型，如 `text/html`、`application/json`。
- **Content-Type**：请求体的类型，如 `application/json`、`application/x-www-form-urlencoded`。
- **Authorization**：包含身份验证信息，如 Basic 或 Bearer Token。
- **Cookie**：客户端存储的 Cookies，通常用于会话管理。
### 2.1.4 请求体（Request Body）
请求体包含请求的具体数据，例如表单数据或上传的文件。对于 `POST`、`PUT` 等方法，通常需要有请求体。
## 2.2 HTTP响应过程
服务器响应客户端请求时，会返回一个响应，包括响应码、响应头和响应体。
#### 4.1 响应码（Response Status Code）
响应码是一个三位数的数字，表示服务器处理请求的结果。常见的响应码有：
- **1xx（信息性）**：指示请求正在处理中，如 `100 Continue`。
- **2xx（成功）**：请求成功，如 `200 OK`，`201 Created`。
- **3xx（重定向）**：请求需要进一步操作，如 `301 Moved Permanently`，`302 Found`。
- **4xx（客户端错误）**：请求有问题，如 `400 Bad Request`，`401 Unauthorized`，`404 Not Found`。
- **5xx（服务器错误）**：服务器处理请求时出错，如 `500 Internal Server Error`，`502 Bad Gateway`。
#### 4.2 响应头（Response Headers）
响应头部提供了关于响应的信息，常见的响应头包括：
- **Content-Type**：响应体的数据类型，如 `text/html`、`application/json`。
- **Content-Length**：响应体的长度（字节数）。
- **Cache-Control**：缓存控制策略，如 `no-cache`、`max-age=3600`。
- **Set-Cookie**：设置 Cookie。
- **Location**：在重定向响应中，指定新的 URL。
#### 4.3 响应体（Response Body）

响应体是服务器返回给客户端的实际数据，如 HTML 文档、JSON 数据或文件内容等。
# 3.GET 和 POST

## 3.1 **基本概念**
- **用途**：`GET` 方法用于请求服务器上的资源，通常用于获取数据（如网页、图片、JSON 数据等）。它的主要作用是获取而非修改数据。
- **语义**：`GET` 请求是“安全的”请求，表示对服务器没有副作用，不会改变服务器的状态。它是幂等的，意味着多次请求相同的 URL 会得到相同的结果。
### 3.1.2 **请求数据方式**
- `GET` 请求将数据（如查询参数）附加在 URL 后面，通常以查询字符串的形式。比如：
`https://www.example.com/search?q=python&page=1`
- `q=python` 是查询参数，用于搜索关键词。
- `page=1` 是分页参数，用于指定当前请求的是第一页的结果。
- 数据被编码在 URL 中，因此数据的大小受 URL 长度的限制（通常大约为 2000 字符）。不同浏览器和 Web 服务器对 URL 长度的限制可能有所不同。
### 3.1.3 **请求头部和请求体**
- **请求头**：`GET` 请求包含请求头，但没有请求体。请求头中可以包含一些元数据，如 `User-Agent`、`Accept`、`Authorization` 等。
- **请求体**：`GET` 请求不包括请求体。所有的数据都在 URL 中通过查询字符串传递。
###  3.1.4 **常见使用场景**
- **查询数据**：`GET` 用于获取资源，像获取网页内容、查询数据库、显示列表等。
- **浏览器书签**：由于 `GET` 请求可以通过 URL 共享和保存，所以它通常用于那些不包含敏感信息的请求。
- **缓存**：`GET` 请求可以被浏览器和代理服务器缓存。这是因为它通常是安全的，且不改变服务器的状态。
- **数据长度限制**：由于数据是附加在 URL 后面，受 URL 长度的限制，不适合传输大量数据。
- **安全性较低**：因为数据是暴露在 URL 中，不适合传输敏感信息（如密码、信用卡号等）。
- **无法包含复杂的数据结构**：无法在请求体中发送 JSON、XML 等复杂的数据结构。
## 3.2 **POST 方法**

#### 3.2.1 **基本概念**
- **用途**：`POST` 方法用于向服务器提交数据，通常用于创建或修改资源。它不仅仅是请求数据，更多的是在服务器端执行某种操作（如提交表单、上传文件等）。
- **语义**：`POST` 请求不是“安全的”请求，因为它可以更改服务器的状态（如添加、更新或删除数据）。它不幂等，多次执行相同的 `POST` 请求会导致不同的结果。
#### 3.2.2**请求数据方式**
- `POST` 请求的主要特点是数据被放在请求体中，而不是 URL 中。这样可以传递大量数据，也可以传递更复杂的数据结构。
    `POST /login HTTP/1.1 Host: example.com Content-Type: application/x-www-form-urlencoded Content-Length: 28  username=alice&password=secret123`
- `POST` 请求的数据可以通过不同的编码方式发送，如：
- **`application/x-www-form-urlencoded`**：这是表单提交的默认编码格式，数据以键对的形式发送。
- **`multipart/form-data`**：用于文件上传，允许发送二进制数据
- **`application/json`**：用于发送 JSON 格式的数据。
#### 3.2.3**请求头部和请求体**
- **请求头**：`POST` 请求的头部通常包含内容类型 (`Content-Type`)、内容长度 (`Content-Length`)、授权信息等。
- **请求体**：请求体是 `POST` 请求的主要部分，用于携带提交的数据。它可以包含复杂的数据，如 JSON 对象、文件等。
#### 3.2.4**常见使用场景**
- **提交表单**：例如，登录表单、注册表单、搜索表单等。
- **上传文件**：当需要上传图片、文档等文件时，使用 `POST` 请求，并通过 `multipart/form-data` 编码方式上传文件。
- **提交数据并期望修改状态**：例如，提交评论、点赞、订单支付等操作，这些操作通常会改变服务器上的数据。
#### 3.2.5 优点
- **没有数据长度限制**：请求数据放在请求体中，没有 URL 长度限制，适合发送大量数据。
- **可以传输复杂数据**：可以发送 JSON、XML 等复杂格式的数据，支持多种数据编码方式。
- **安全性较高**：虽然 `POST` 请求的数据也可以被截获，但它的参数不会暴露在 URL 中，因此比 `GET` 更适合发送敏感信息。
总结：
- **GET** 方法用于从服务器获取数据，数据通过 URL 的查询字符串传递，适用于查询操作。它是无副作用的，幂等的，支持缓存和共享。
- **POST** 方法用于向服务器提交数据，数据通过请求体传输，适用于创建、修改资源和提交表单等操作。它没有长度限制，并且可以传输复杂数据。`POST` 不支持缓存，也不能像 `GET` 一样共享。

# 爬虫的基本原理
爬虫（Web Scraping）是通过编程方式从网站上抓取数据的技术。它的基本原理是模拟浏览器的行为，通过发送 HTTP 请求获取网页内容，然后解析网页，提取出有用的数据。爬虫广泛应用于搜索引擎、数据分析、信息抽取、内容聚合等领域。
### 基本原理概述
1. **发送请求**：爬虫通过 HTTP 请求向目标网站发起请求，获取网页内容。
2. **获取响应**：网站服务器返回响应数据，通常是 HTML 或 JSON 格式。
3. **解析数据**：爬虫解析网页数据，提取需要的信息，通常使用正则表达式、XPath 或 CSS 选择器等工具。
4. **数据存储**：将抓取到的数据存储到本地文件、数据库或其他存储系统中，便于后续处理和分析。
5. **循环迭代**：爬虫通常会遍历多页或者抓取多个网站，所以需要进行递归或循环操作，不断发送请求、获取数据、解析数据，直到完成抓取任务。
# Session和Cookie
- **Cookie** 是由服务器发送到客户端（浏览器）的小块数据，通常存储在用户的浏览器中。每当用户再次访问该网站时，浏览器会自动将该 Cookie 随请求一起发送回服务器。
- Cookie 用于保存会话信息（如登录状态、用户偏好设置、跟踪用户行为等）。
- **Session** 是服务器端的一种存储机制，用于存储用户的会话信息。与 Cookie 不同，Session 数据通常存储在服务器端，而客户端（浏览器）只存储一个标识符（如 Session ID）。
- Session 主要用于在多个请求之间保持状态（如用户登录后的身份信息），它通常在服务器的内存或数据库中存储。
总结
- **Cookie**：是存储在客户端的小型数据，通常用于在客户端和服务器之间传递小量数据（如用户标识、偏好设置）。它有大小和数量的限制，而且容易受到安全问题的影响（如 XSS 攻击）。
- **Session**：是服务器端的会话管理机制，通过将数据存储在服务器端而不是客户端，提供了更高的安全性和更多的存储空间。Session 通常与 Cookie 配合使用，使用 Session ID 识别用户。
# 代理的基本概念
代理（Proxy）是一种位于客户端和服务器之间的中介服务器，它接受客户端的请求，并代表客户端向目标服务器发送请求，随后将目标服务器的响应返回给客户端。
代理的基本原理就是通过充当中介来转发请求和响应，客户端与代理服务器之间的通信通常是透明的，客户端并不知道自己实际请求的是代理服务器，而不是目标服务器。代理在实际使用时可能会进行数据过滤、修改、缓存、加密等操作。
## 工作过程
- **客户端请求**：客户端通过代理服务器发起 HTTP 请求。
- **代理处理请求**：
   - 如果是正向代理，代理将请求转发给目标服务器。代理可以修改请求头或其他请求信息，例如添加用户的身份标识、修改目标服务器的域名等。
   - 如果是反向代理，代理接收请求并根据请求的不同内容将请求转发到不同的后端服务器进行处理。
- **目标服务器响应**：目标服务器接收到请求并进行处理，返回响应。
- **代理返回响应**：代理服务器将目标服务器的响应数据返回给客户端。在此过程中，代理服务器可能对响应内容进行修改，如缓存、压缩、加密等。
- **客户端接收响应**：客户端接收到响应并进行处理，展示给用户。
# 多线程和多进程
## 多线程
**线程**是进程中的一个执行单元。一个进程可以有多个线程，它们共享进程的资源（如内存、文件描述符等）。
**多线程**指的是一个进程内的多个线程并发执行任务，它们共享进程的资源，可以更高效地进行任务处理，尤其适合I/O密集型任务。
## 多进程
**进程**是操作系统资源分配的基本单位。每个进程有自己的地址空间、文件描述符、栈等资源。
**多进程**指的是多个独立的进程并发执行任务，每个进程都有自己的内存空间和资源。
## 总结
- **多线程**适用于 I/O 密集型任务，例如网络请求、文件读写等。由于线程之间共享资源，线程创建开销小，通信高效，但需要解决线程安全问题。
- **多进程**适用于 CPU 密集型任务，因为每个进程可以在独立的 CPU 核心上运行。进程间不会相互干扰，因此可以提高系统的稳定性，但进程间通信复杂且开销较大。
